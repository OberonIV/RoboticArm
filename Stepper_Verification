/*
Author: Carl Jeffri Resurreccion
Date: Feburary 1, 2025
This code verifies two 28BYJ-48 motors with different commands.
These commands include enabling either motor, both motors,
both motors operating in different directions, and halting all processes.
*/
#include <Stepper.h>
#include <Servo.h>

const int steps_per_revolution = 2048;
const int role_per_minute = 10;  // Adjust speed for smooth motion

// Initialize stepper motor
Stepper stepper_1(steps_per_revolution, 8, 10, 9, 11);

// Initialize servo motor
Servo servo_1;
const int servo_pin = 3;  // Servo connected to pin 3

void setup() {
  Serial.begin(9600); // Baud rate
  stepper_1.setSpeed(role_per_minute);
  servo_1.attach(servo_pin);
  
  Serial.println("Enter a command:");
  Serial.println("'s' = Move Stepper");
  Serial.println("'0' to '180' = Move Servo to Angle");
  Serial.println("'x' = Stop Stepper");
}

void loop() {  
  if (Serial.available() > 0) {
    String input = Serial.readStringUntil('\n'); // Read user input
    input.trim(); // Remove any whitespace
    
    if (input == "s") {
      Serial.println("Turning Stepper Motor and Moving Servo");
      for (int i = 0; i < steps_per_revolution; i++) {
        stepper_1.step(1);
        int angle = map(i, 0, steps_per_revolution, 0, 180);
        servo_1.write(angle);
        delay(2); // Small delay to allow both movements
      }
    } 
    else if (input == "x") {
      Serial.println("Stopping Stepper Motor");
      // No stepping occurs, effectively stopping the motor
    } 
    else {
      int angle = input.toInt();
      if (angle >= 0 && angle <= 180) {
        Serial.print("Moving Servo to ");
        Serial.print(angle);
        Serial.println(" degrees");
        servo_1.write(angle);
      } else {
        Serial.println("Invalid command. Enter 's', 'x', or an angle between 0-180.");
      }
    }
  }
}
